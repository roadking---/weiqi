// Generated by CoffeeScript 1.6.2
(function() {
  var uid, _ref;

  uid = (_ref = /u\/(.+)$/.exec(location.pathname)) != null ? _ref[1] : void 0;

  $.get("/json/u/" + uid, function(data) {
    console.log(data);
    init_header(data);
    $('nav #mine').parent().addClass('active');
    $('#heading').append(tpl('#heading_tpl')(data));
    $('#profile').append(tpl('#profile_tpl')(data));
    $('#invites #received').append(tpl('#received_invites_tpl')(data));
    $('#invites #sent').append(tpl('#sent_invites_tpl')(data));
    $('#current').append(tpl('#current_game_tpl')(_.defaults(data, {
      current: data.query.current
    })));
    $('#recent_history').append(tpl('#recent_history_tpl')(_.defaults(data, {
      recent_history: data.query.recent_history
    })));
    $('#current ul li').each(function(i, li) {
      var gid;

      gid = $(li).attr('gid');
      return new BoardCanvas($(li).find('.thumb')).render(data.refs[gid].moves);
    });
    return $('a.follow, a.unfollow').click(function() {
      var _this = this;

      if ($(this).hasClass('follow')) {
        return $.get("/unfollow/" + data.uid, function(rlt) {
          if (rlt.success) {
            return $(_this).addClass('unfollow').removeClass('follow');
          }
        });
      } else {
        return $.get("/unfollow/" + data.uid, function(rlt) {
          if (rlt.success) {
            return $(_this).addClass('follow').removeClass('unfollow');
          }
        });
      }
    });
  });

}).call(this);
