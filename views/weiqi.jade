extends layout

block title
	- console.log(opts);
	if opts.seats && _.keys(opts.seats).length == 2
		title #{refs[opts.seats.black].nickname} #{title(refs[opts.seats.black].title)} (#{lingua.black_short}) vs #{refs[opts.seats.white].nickname} #{title(refs[opts.seats.white].title)} (#{lingua.white_short})
	else if opts.players && opts.players.length == 1
		title xx
	else if opts.players && opts.players.length == 2
		title #{refs[opts.players[0]].nickname} #{title(refs[opts.players[0]].title)} vs #{refs[opts.players[1]].nickname} #{title(refs[opts.players[1]].title)}
	else
		title Move

block append scripts
	script(src='/socket.io/socket.io.js')
	script(src='/js/board.js')
	script(src='/js/thumbnail.js')
	script(src='/js/weiqi_rule.js')
	//script(src='/js/publish.js')
	script(src='/js/weiqi.js')

block content
	#game-notice.row(_text=JSON.stringify(_.pick(lingua, 'started_please_move', 'started_please_wait')))
		if opts.status == 'init'
			if user && user.my_new_game == opts.id
				p.text-warning.offset3= lingua.init_waiting
			else
				p.text-warning.offset3= lingua.init_attending
					a.btn.btn-primary(href='/attend/#{gid}')= lingua.start_game
		else if opts.status == 'taking_seat'
			if user && _.contains(opts.players, user.id)
				if opts.seats && _.chain(opts.seats).values().contains(user.id).value()
					p.text-warning.offset3= lingua.taking_seat_waiting_opponent
				else
					p.text-warning.offset3= lingua.taking_seat_please
			else
				p.text-warning.offset3= lingua.taking_seat_waiting
		else if opts.status == 'started'
			if user && _.contains(opts.players, user.id)
				if opts.next == _.invert(opts.seats)[user.id]
					p.text-warning.offset3= lingua.started_please_move
				else
					p.text-success.offset3= lingua.started_please_wait
		else if opts.status == 'need_player'
			if user && _.contains(opts.players, user.id)
				p.text-warning.offset3= lingua.need_player_wait
			else
				p.text-warning.offset3= lingua.need_player_invite
					a.btn.btn-primary(href='/attend/#{gid}')= lingua.start_game
	
	if opts.status == 'taking_seat'
		#seats(_text=lingua.me).row
			#black.span6.vacant
				span.nickname ?
				span.title
			#white.span6.vacant
				span.nickname ?
				span.title
	
	.row-fluid
		.span8
			#tabs.nav.nav-tabs
				li.active: a#gaming(href='#')= lingua.gaming
				li: a#trying(href='#')= lingua.tring
				if user && opts.players && _.contains(opts.players, user.id)
					li
						if opts.players.length > 1
							a(href='/quit/#{gid}')= lingua.quit
						else
							a(href='/delete/#{gid}')= lingua.delete
					li: a#surrender(href='#')= lingua.surrender
				li: a#detail(href='#')= lingua.detail
			
			if opts.result
				if opts.result.win
					if opts.result.case == 'white surrenders'
						h3#game-result= lingua.black_won_without_number
					else if opts.result.case == 'black surrenders'
						h3#game-result= lingua.white_won_without_number
			
			include board
			mixin board('gaming-board', opts)
			#surrender-view.hide
				a#confirm-surrender.btn(href='/surrender/#{gid}')= lingua.surrender
			#detail-view.hide
				.row-fluid
					.offset1= lingua['status_' + opts.status]
				each x in opts.players
					.row-fluid
						.span2.offset1: a(href='/u/#{x}')= refs[x].nickname
						.span2.offset1: span.rate= refs[x].rate
		.span4
			.row
				.span6.offset1
					include widget/publish
			aside#blogs.container(_me=user?user.nickname:'anonymous')
				include widget/blog